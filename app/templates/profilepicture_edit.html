{% extends "base.html" %}

{% block content %}
<div class="container mx-auto mt-10 flex justify-center">
  <div class="bg-gray-900 p-6 rounded-lg shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold text-white mb-6">Edit Profile</h2>

    <form method="POST" enctype="multipart/form-data">
      {{ form.csrf_token }}
      <div class="flex flex-col items-center mb-6">
        <div class="w-32 h-32 rounded-full bg-gray-700 overflow-hidden">
          <img id="previewImage"
               src="{{ url_for('static', filename='uploads/' ~ user.profile_picture) if user.profile_picture else url_for('static', filename='default-avatar.png') }}"
               alt="Avatar"
               class="w-full h-full object-cover">
        </div>

        <label for="profilePictureInput"
               class="mt-2 text-sm text-orange-400 cursor-pointer hover:underline flex items-center space-x-1">
          <svg class="w-4 h-4 text-orange-400" fill="currentColor" viewBox="0 0 20 20">
            <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm4 3a1 1 0 012 0v4h2l-3 3-3-3h2V6z"/>
          </svg>
          <span>Upload Picture</span>
        </label>
        <!-- Hidden file input -->
        {{ form.profile_picture(class="hidden", id="profilePictureInput") }}
      </div>

      <!-- Username field -->
      <div class="mb-4">
        {{ form.username.label(class="block text-sm text-gray-300 mb-1") }}
        {{ form.username(class="w-full px-4 py-2 rounded-md bg-gray-800 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500") }}
        {% if form.username.errors %}
          <p class="text-red-500 text-sm mt-1">{{ form.username.errors[0] }}</p>
        {% endif %}
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <a href="{{ url_for('main.dashboard') }}" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Cancel</a>
        {{ form.submit(class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700") }}
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const input = document.getElementById('profilePictureInput');
    const preview = document.getElementById('previewImage');
    input.addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>

{% endblock %}
