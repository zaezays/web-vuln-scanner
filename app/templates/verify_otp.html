{# templates/verify_otp.html #}
{% extends "auth_base.html" %}

{% block content %}
<section class="min-h-screen flex items-center justify-center bg-gray-900">
  <div class="w-full max-w-md bg-white rounded-xl shadow-xl p-8">

    <h2 class="text-2xl font-bold mb-4 text-center text-gray-900">OTP Verification</h2>
    <p class="text-center text-sm text-gray-600 mb-6">
      OTP sent to <strong>{{ email }}</strong><br>
      Enter the code below.
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="mb-4 px-4 py-2 rounded text-sm text-white {{ 'bg-green-600' if category=='success' else 'bg-red-600' }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('main.verify_otp_route') }}" id="otp-form">
      {{ form.hidden_tag() }}

      <div class="flex gap-2 justify-center mb-4 otp-inputs">
        {% for i in range(6) %}
        <input maxlength="1" required type="text" pattern="\d*" inputmode="numeric"
               class="w-12 h-12 text-center border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
               data-index="{{ i }}" />
        {% endfor %}
      </div>

      {{ form.otp_code(type="hidden", id="otp_code_combined") }}

      <button type="submit"
              class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">
        Verify OTP
      </button>
    </form>

  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const otpForm = document.getElementById('otp-form');
    const inputs = document.querySelectorAll('.otp-inputs input');
    const hiddenInput = document.getElementById('otp_code_combined');

    inputs.forEach((input, idx) => {
      input.addEventListener('input', () => {
        if (input.value.length === 1 && idx < inputs.length - 1) {
          inputs[idx + 1].focus();
        }
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && input.value === '' && idx > 0) {
          inputs[idx - 1].focus();
        }
      });
    });

    otpForm.addEventListener('submit', function(e) {
      let otp = '';
      inputs.forEach(i => otp += i.value);
      hiddenInput.value = otp;
    });
  });
</script>
{% endblock %}




